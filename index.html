<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>バーチャルオフィス</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles/theme.css">
  <link rel="stylesheet" href="styles/base.css">
  <link rel="stylesheet" href="styles/layout.css">
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🏢</text></svg>">
</head>

<body data-theme="theme:day">
  <div id="app">
    <!-- Loading Screen -->
    <div id="loading-screen">
      <div class="loading-spinner"></div>
      <div class="loading-text">読み込み中...</div>

      <!-- Boot Log & Fatal Error -->
      <pre id="bootLog" style="
        margin-top:12px;
        padding:10px;
        max-width:520px;
        max-height:220px;
        overflow:auto;
        background:rgba(0,0,0,0.06);
        border-radius:8px;
        font-size:12px;
        line-height:1.4;
        white-space:pre-wrap;
        color: var(--color-text);
        text-align: left;
      "></pre>

      <div id="fatalError" style="
        display:none;
        margin-top:12px;
        padding:12px;
        max-width:520px;
        background:#ffe9e9;
        border:1px solid #ff7a7a;
        border-radius:10px;
        color:#6b0000;
        font-size:13px;
        white-space:pre-wrap;
        text-align: left;
      "></div>
    </div>

    <!-- Menubar -->
    <header id="menubar" class="hidden">
      <div class="logo">
        <div class="logo-icon"></div>
        <span>バーチャルオフィス</span>
      </div>
      <nav class="nav">
        <button class="nav-btn" data-drawer="chat" title="チャット">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
          </svg>
          <span class="chat-unread-dot" id="chat-unread-dot" aria-hidden="true"></span>
          <span>チャット</span>
        </button>
        <button class="nav-btn" data-drawer="people" title="メンバー">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
            <circle cx="9" cy="7" r="4" />
            <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
            <path d="M16 3.13a4 4 0 0 1 0 7.75" />
          </svg>
          <span>メンバー</span>
        </button>
        <button class="nav-btn" data-drawer="search" title="検索">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8" />
            <path d="m21 21-4.35-4.35" />
          </svg>
          <span>検索</span>
        </button>
        <div class="nav-dropdown" id="map-menu">
          <button class="nav-btn" id="map-menu-btn" title="マップ">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 6v16l7-4 8 4 7-4V2l-7 4-8-4-7 4z" />
              <path d="M8 2v16" />
              <path d="M16 6v16" />
            </svg>
            <span id="map-menu-label">マップ</span>
          </button>
          <div class="nav-dropdown-content" id="map-dropdown">
            <button class="nav-dropdown-item active" data-area="area:core">オフィス</button>
            <button class="nav-dropdown-item" data-area="area:garden">ガーデン</button>
            <button class="nav-dropdown-item" data-area="area:library">ライブラリ</button>
          </div>
        </div>
        <button class="nav-btn" data-drawer="settings" title="設定">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3" />
            <path
              d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
          </svg>
          <span>設定</span>
        </button>
      </nav>
      <div class="status-indicator">
        <span id="my-display-name"></span>
        <div id="my-status-dot" class="status-dot"></div>
      </div>
    </header>

    <!-- Main Area -->
    <main id="main" class="hidden">
      <!-- Map Canvas -->
      <div id="canvas-container">
        <canvas id="map-canvas"></canvas>
      </div>

      <!-- Context Panel -->
      <div id="context-panel">
        <span class="panel-title" id="context-title"></span>
        <div class="panel-actions" id="context-actions"></div>
      </div>

      <!-- Minimap (optional) -->
      <div id="minimap">
        <canvas id="minimap-canvas"></canvas>
      </div>
    </main>

    <!-- Drawer Overlay -->
    <div id="drawer-overlay"></div>

    <!-- Drawer -->
    <aside id="drawer">
      <div class="drawer-header">
        <h2 class="drawer-title" id="drawer-title">ドロワー</h2>
        <button class="drawer-close" id="drawer-close">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6 6 18M6 6l12 12" />
          </svg>
        </button>
      </div>

      <!-- Chat Drawer Content -->
      <div id="drawer-chat" class="hidden">
        <div class="chat-tabs">
          <button class="chat-tab active" data-chat-tab="all">全体</button>
          <button class="chat-tab" data-chat-tab="room">ルーム</button>
          <button class="chat-tab" data-chat-tab="dm">DM</button>
        </div>
        <div class="chat-messages" id="chat-messages"></div>
        <div class="chat-input-container">
          <input type="text" class="chat-input" id="chat-input" placeholder="メッセージを入力...">
          <button class="btn btn-primary" id="chat-send">送信</button>
        </div>
      </div>

      <!-- People Drawer Content -->
      <div id="drawer-people" class="drawer-content hidden">
        <div class="people-list" id="people-list"></div>
      </div>

      <!-- Search Drawer Content -->
      <div id="drawer-search" class="drawer-content hidden">
        <div class="search-input-container">
          <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="2">
            <circle cx="11" cy="11" r="8" />
            <path d="m21 21-4.35-4.35" />
          </svg>
          <input type="text" class="search-input" id="search-input" placeholder="メンバーを検索...">
        </div>
        <div class="people-list" id="search-results"></div>
      </div>

      <!-- Settings Drawer Content -->
      <div id="drawer-settings" class="drawer-content hidden">
        <div class="settings-section">
          <div class="settings-label">表示名</div>
          <div class="form-group">
            <input type="text" class="form-input" id="settings-name" placeholder="あなたの名前">
            <button class="btn btn-secondary" id="settings-name-save" style="margin-top: 8px;">保存</button>
          </div>
        </div>
        <div class="settings-section">
          <div class="settings-label">ステータス</div>
          <div class="theme-options">
            <button class="theme-option" data-status="online">
              <div class="theme-preview" style="background: #10b981;"></div>
              <div class="theme-name">オンライン</div>
            </button>
            <button class="theme-option" data-status="away">
              <div class="theme-preview" style="background: #f59e0b;"></div>
              <div class="theme-name">離席</div>
            </button>
            <button class="theme-option" data-status="focus">
              <div class="theme-preview" style="background: #ef4444;"></div>
              <div class="theme-name">集中</div>
            </button>
          </div>
        </div>
        <div class="settings-section">
          <div class="settings-label">テーマ</div>
          <div class="theme-options" id="theme-options">
            <button class="theme-option active" data-theme="theme:day">
              <div class="theme-preview" style="background: linear-gradient(135deg, #f8fafc, #e2e8f0);"></div>
              <div class="theme-name">昼</div>
            </button>
            <button class="theme-option" data-theme="theme:night">
              <div class="theme-preview" style="background: linear-gradient(135deg, #0f172a, #1e293b);"></div>
              <div class="theme-name">夜</div>
            </button>
            <button class="theme-option" data-theme="theme:mono">
              <div class="theme-preview" style="background: linear-gradient(135deg, #fafafa, #d4d4d4);"></div>
              <div class="theme-name">モノ</div>
            </button>
          </div>
        </div>
        <div class="settings-section">
          <div class="settings-label">音声</div>
          <div class="form-group">
            <label class="form-label" for="audio-mic">マイク</label>
            <select class="form-input" id="audio-mic">
              <option value="">-- マイクを選択 --</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="audio-speaker">スピーカー</label>
            <select class="form-input" id="audio-speaker">
              <option value="">-- スピーカーを選択 --</option>
            </select>
            <div class="form-hint" id="audio-speaker-hint"></div>
          </div>
          <button class="btn btn-secondary" id="audio-refresh">🔄 デバイス再読み込み</button>
        </div>
        <div class="settings-section">
          <div class="settings-label">アカウント</div>
          <button class="btn btn-secondary" id="settings-logout">ログアウト</button>
          <button class="btn btn-secondary" id="settings-clear-pw" style="margin-left: 8px;">保存済みパスワードを削除</button>
        </div>
      </div>
    </aside>

    <!-- Modal Overlay -->
    <div id="modal-overlay">
      <!-- Password Modal -->
      <div class="modal" id="modal-password">
        <div class="modal-header">
          <h2 class="modal-title">社内ログイン</h2>
          <p class="modal-subtitle">共通パスワードを入力してください</p>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label" for="password-input">パスワード</label>
            <input type="password" class="form-input" id="password-input" placeholder="パスワードを入力">
            <div class="form-error hidden" id="password-error"></div>
          </div>
          <label class="form-checkbox">
            <input type="checkbox" id="password-save">
            <span>この端末に保存する</span>
          </label>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" id="password-submit">ログイン</button>
        </div>
      </div>

      <!-- Nameplate Modal -->
      <div class="modal hidden" id="modal-nameplate">
        <div class="modal-header">
          <h2 class="modal-title">名札の設定</h2>
          <p class="modal-subtitle">表示名を入力してください</p>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label" for="nameplate-input">表示名</label>
            <input type="text" class="form-input" id="nameplate-input" placeholder="表示名を入力" maxlength="20">
            <div class="form-hint">最大20文字</div>
            <div class="form-error hidden" id="nameplate-error"></div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" id="nameplate-submit">保存</button>
        </div>
      </div>

      <!-- Incoming Call Modal -->
      <div class="modal hidden" id="modal-incoming-call">
        <div class="modal-header">
          <h2 class="modal-title">着信</h2>
          <p class="modal-subtitle" id="incoming-call-from"></p>
        </div>
        <div class="modal-body" style="text-align: center;">
          <div style="font-size: 48px; margin: 20px 0;">📞</div>
        </div>
        <div class="modal-footer" style="justify-content: center;">
          <button class="btn btn-danger" id="call-reject">拒否</button>
          <button class="btn btn-primary" id="call-accept">応答</button>
        </div>
      </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script type="module" src="src/boot.js?v=20260201_2"></script>
</body>

</html>
